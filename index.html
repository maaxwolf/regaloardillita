<html>
<body style=â€™font-size:40pxâ€™>
<div id=lockeddiv style=â€™font-style:italicâ€™></div>
<div id=messagediv style=â€™font-style:italicâ€™>ApretÃ¡ acÃ¡ ğŸ˜ƒ</div>
<script>
var music = new Audio(â€œhttp://curtastic.com/nightmare.mp3")
var chime = new Audio(â€œhttp://curtastic.com/gold.wav")
var nothing = new Audio(â€œhttp://touchbasicapp.com/nothing.wav")
var allAudio = []
allAudio.push(music)
allAudio.push(chime)

var tapped = function() {
messagediv.innerHTML = â€œtappedâ€

// Play all audio files on the first tap and stop them immediately.
if(allAudio) {
for(var audio of allAudio) {
audio.play()
audio.pause()
audio.currentTime = 0
}
allAudio = null
}

// We should be able to play music delayed now (not during the tap event).
messagediv.innerHTML = â€œMusic starts in 2 secondsâ€¦â€
setTimeout(function() {
messagediv.innerHTML = â€œMusic playing. <button onclick=â€™stop()â€™>Stop</button>â€
music.play()
}, 2000)

}
document.body.addEventListener(â€˜touchstartâ€™, tapped, false)
document.body.addEventListener(â€˜clickâ€™, tapped, false)

var stop = function() {
music.pause()
loop = null
document.body.removeEventListener(â€˜touchstartâ€™, tapped, false)
document.body.removeEventListener(â€˜clickâ€™, tapped, false)
}

// Check if audio starts already unlocked by playing a blank wav.
nothing.play().then(function() {
lockeddiv.innerHTML = â€œAudio started unlocked!â€
}).catch(function(){
lockeddiv.innerHTML = â€œAudio started locked :(â€œ
})

var loop = function() {
// Try to play chimes whenever we want (not during user action).
if(Math.random() < .01) {
chime.play().then(function(){
lockeddiv.innerHTML = â€œAudio is now unlocked!â€
})
}
setTimeout(loop, 16)
}
loop()
</script>
<div style=â€™height:70vh;background:#EFEâ€™>
The rest of the webpage takes up all of this space.
On Safari audio will start on the first tap anywhere.
On Chrome it will try to determine if the user has interacted much with this page or this domain, before playing.
</div>
</body>
</html>
